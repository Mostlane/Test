<!doctype html>
<html><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>FSM Dashboard</title>
  <link rel="stylesheet" href="../style.css"/>
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="icon-180.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#003366">
  <script>
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
  </script>

  <style>
/* Portal-native FSM skin */
.fsm-body {
  background: #e6e8eb url('../Mostlane_Embossed.png') no-repeat fixed;
  background-size: 180% auto;
  margin: 0;
  min-height: 100vh;
  font-family: Arial, sans-serif;
}
.fsm-wrap {
  max-width: 820px;
  margin: 0 auto;
  padding: 16px;
  text-align: left;
}
.fsm-header {
  background-color: #003366; /* portal blue */
  color: #fff;
  border-radius: 8px;
  padding: 10px 14px;
  display:flex; align-items:center; gap:10px;
}
.fsm-header img { height: 38px; width: auto; }
.fsm-header .title { font-size: 18px; font-weight: 700; margin: 0; }
.fsm-box {
  background: rgba(255,255,255,0.60);
  border-radius: 12px;
  padding: 14px;
  margin: 16px 0;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}
.fsm-grid2 { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 720px) { .fsm-grid2 { grid-template-columns: 1fr 1fr; } }
.fsm-kpi { background: rgba(255,255,255,0.70); border-radius: 12px; padding: 12px; }
.fsm-kpi .v { font-weight: 800; font-size: 24px; }
.fsm-kpi .l { color: #5f6876; font-size: 12px; margin-top: 4px; }
.fsm-input, .fsm-select, .fsm-textarea {
  width: 100%; padding: 12px 14px; border-radius: 10px;
  border: 1px solid #d6dbe1; background: #fff; font-size: 15px;
}
.fsm-btn { display:inline-block; padding:12px 16px; border-radius: 10px; border:1px solid #003366;
           background:#e6f0fa; color:#003366; font-weight:700; text-decoration:none; }
.fsm-btn.primary { background:#003366; color:#fff; }
.fsm-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.fsm-card { background: rgba(255,255,255,0.70); border-radius: 12px; padding: 12px; margin: 10px 0; }
.fsm-meta { color:#5f6876; font-size:12px; }
.fsm-chip { font-size:12px; padding:6px 10px; border-radius:999px; color:#fff; font-weight:800; display:inline-block; }
.fsm-New { background:#9aa7b6 } .fsm-Assigned { background:#003366 } .fsm-InProgress { background:#f1a331 }
.fsm-Completed { background:#23966e } .fsm-OnHold { background:#7d8694 } .fsm-Cancelled { background:#a1a7b2 }
.fsm-footer { text-align:center; padding-bottom: 40px; color:#5f6876; font-size:12px }

.fsm-header .nav { margin-left:auto; display:flex; gap:8px; }
.fsm-link { display:inline-block; padding:8px 12px; border-radius:8px; text-decoration:none;
            background:#e6f0fa; color:#003366; border:1px solid #003366; font-weight:700; font-size:13px; }
.fsm-link.primary { background:#003366; color:#fff; }
.menu-buttons { display:grid; gap:12px; grid-template-columns:1fr; }
@media(min-width:700px){ .menu-buttons{ grid-template-columns:1fr 1fr; } }
.big-btn { display:block; text-align:center; padding:18px; font-size:16px; font-weight:800;
           background:#e6f0fa; color:#003366; border:1px solid #003366; border-radius:12px; text-decoration:none; }

</style>
  <script defer src="assets/app.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded',()=>{
    const k=MFSM.KPIs(MFSM.loadJobs());
    document.getElementById('k1').textContent=k.open;
    document.getElementById('k2').textContent=k.today;
    document.getElementById('k3').textContent=k.overdue;
    document.getElementById('k4').textContent=k.risk;
    const recent=MFSM.loadJobs().slice().sort((a,b)=>new Date(b.updatedAt||b.createdAt)-new Date(a.updatedAt||a.createdAt)).slice(0,5);
    const list=document.getElementById('recent');
    for(const j of recent){
      const d=document.createElement('div'); d.className='fsm-card';
      const st='fsm-'+j.status.replace(' ',''); 
      d.innerHTML=`<div class="fsm-row" style="justify-content:space-between">
        <div><strong>${j.id}</strong> — ${j.title}</div>
        <span class="fsm-chip ${st}">${j.status}</span></div>
        <div class="fsm-meta">${j.site||''} · Updated ${new Date(j.updatedAt||j.createdAt).toLocaleString()}</div>
        <div class="fsm-row"><a class="fsm-btn" href="job.html?id=${j.id}">Open</a></div>`;
      list.appendChild(d);
    }
  });
  </script>
</head>
<body class="fsm-body">
  <div class="fsm-wrap">
    
<div class="fsm-header">
  <img src="../mostlane-logo.jpg" alt="Mostlane logo"/>
  <h2 class="title">FSM Dashboard</h2>
</div>

    <div class="fsm-box">
      <div class="fsm-grid2">
        <div class="fsm-kpi"><div class="v" id="k1">0</div><div class="l">Open Jobs</div></div>
        <div class="fsm-kpi"><div class="v" id="k2">0</div><div class="l">Due Today</div></div>
        <div class="fsm-kpi"><div class="v" id="k3">0</div><div class="l">Overdue</div></div>
        <div class="fsm-kpi"><div class="v" id="k4">0</div><div class="l">SLA at Risk</div></div>
      </div>
      <div class="fsm-row" style="margin-top:10px">
        <a class="fsm-btn primary" href="create.html">Create Job</a>
        <a class="fsm-btn" href="jobs.html">View Jobs</a>
      </div>
    </div>
    <div class="fsm-box">
      <h3 style="margin:0 0 8px">Recent</h3>
      <div id="recent"></div>
    </div>
    <div class="fsm-footer">Mostlane Portal – FSM</div>
  </div>
</body></html>
