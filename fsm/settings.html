<!doctype html>
<html><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Settings</title>
  <link rel="stylesheet" href="../style.css"/>
  <style>
/* Portal-native FSM skin */
.fsm-body {
  background: #e6e8eb url('../Mostlane_Embossed.png') no-repeat fixed;
  background-size: 180% auto;
  margin: 0;
  min-height: 100vh;
  font-family: Arial, sans-serif;
}
.fsm-wrap {
  max-width: 820px;
  margin: 0 auto;
  padding: 16px;
  text-align: left;
}
.fsm-header {
  background-color: #003366; /* portal blue */
  color: #fff;
  border-radius: 8px;
  padding: 10px 14px;
  display:flex; align-items:center; gap:10px;
}
.fsm-header img { height: 38px; width: auto; }
.fsm-header .title { font-size: 18px; font-weight: 700; margin: 0; }
.fsm-box {
  background: rgba(255,255,255,0.60);
  border-radius: 12px;
  padding: 14px;
  margin: 16px 0;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}
.fsm-grid2 { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 720px) { .fsm-grid2 { grid-template-columns: 1fr 1fr; } }
.fsm-kpi { background: rgba(255,255,255,0.70); border-radius: 12px; padding: 12px; }
.fsm-kpi .v { font-weight: 800; font-size: 24px; }
.fsm-kpi .l { color: #5f6876; font-size: 12px; margin-top: 4px; }
.fsm-input, .fsm-select, .fsm-textarea {
  width: 100%; padding: 12px 14px; border-radius: 10px;
  border: 1px solid #d6dbe1; background: #fff; font-size: 15px;
}
.fsm-btn { display:inline-block; padding:12px 16px; border-radius: 10px; border:1px solid #003366;
           background:#e6f0fa; color:#003366; font-weight:700; text-decoration:none; }
.fsm-btn.primary { background:#003366; color:#fff; }
.fsm-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.fsm-card { background: rgba(255,255,255,0.70); border-radius: 12px; padding: 12px; margin: 10px 0; }
.fsm-meta { color:#5f6876; font-size:12px; }
.fsm-chip { font-size:12px; padding:6px 10px; border-radius:999px; color:#fff; font-weight:800; display:inline-block; }
.fsm-New { background:#9aa7b6 } .fsm-Assigned { background:#003366 } .fsm-InProgress { background:#f1a331 }
.fsm-Completed { background:#23966e } .fsm-OnHold { background:#7d8694 } .fsm-Cancelled { background:#a1a7b2 }
.fsm-footer { text-align:center; padding-bottom: 40px; color:#5f6876; font-size:12px }
</style>
  <script defer src="assets/app.js"></script>
  <script>
  function load(){
    const s=MFSM.loadSettings();
    document.getElementById('company').value=s.company||'';
    document.getElementById('createWH').value=s.webhookJobCreate||'';
    document.getElementById('updateWH').value=s.webhookJobUpdate||'';
    const list=document.getElementById('engList'); list.innerHTML='';
    for(const e of MFSM.loadEngineers()){
      const d=document.createElement('div'); d.className='fsm-card';
      d.innerHTML = `<div class="fsm-row" style="justify-content:space-between"><strong>${e.name}</strong><code>${e.id}</code></div>`;
      list.appendChild(d);
    }
  }
  function save(){
    const s=MFSM.loadSettings();
    s.company=document.getElementById('company').value.trim();
    s.webhookJobCreate=document.getElementById('createWH').value.trim();
    s.webhookJobUpdate=document.getElementById('updateWH').value.trim();
    localStorage.setItem('ms_fsm_settings', JSON.stringify(s));
    alert('Saved.');
  }
  function addEng(){
    const name=prompt('Engineer display name:'); if(!name) return;
    const id=prompt('Unique ID:', name.toLowerCase().replace(/[^a-z0-9]+/g,'.'));
    const arr=MFSM.loadEngineers(); arr.push({id,name}); localStorage.setItem('ms_fsm_engineers', JSON.stringify(arr)); load();
  }
  function exportJobs(){
    const blob=new Blob([JSON.stringify(MFSM.loadJobs(),null,2)],{type:'application/json'});
    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='jobs.json'; a.click();
  }
  function importJobs(e){
    const f=e.target.files[0]; if(!f) return; const r=new FileReader();
    r.onload=()=>{ try{ localStorage.setItem('ms_fsm_jobs', r.result); alert('Imported'); }catch(_){
      alert('Invalid JSON'); } }; r.readAsText(f);
  }
  document.addEventListener('DOMContentLoaded',load);
  </script>
</head>
<body class="fsm-body">
  <div class="fsm-wrap">
    
<div class="fsm-header">
  <img src="../mostlane-logo.jpg" alt="Mostlane logo"/>
  <h2 class="title">Settings</h2>
</div>

    <div class="fsm-box">
      <div class="fsm-grid2">
        <div><div class="fsm-meta">Company</div><input id="company" class="fsm-input"/></div>
        <div></div>
        <div><div class="fsm-meta">Zapier webhook – Create</div><input id="createWH" class="fsm-input" placeholder="https://hooks.zapier.com/..."/></div>
        <div><div class="fsm-meta">Zapier webhook – Update</div><input id="updateWH" class="fsm-input" placeholder="https://hooks.zapier.com/..."/></div>
      </div>
      <div class="fsm-row" style="margin-top:10px"><a class="fsm-btn primary" onclick="save()">Save</a></div>
    </div>
    <div class="fsm-box">
      <div class="fsm-row" style="justify-content:space-between; align-items:center">
        <h3 style="margin:0">Engineers</h3><a class="fsm-btn" onclick="addEng()">Add</a>
      </div>
      <div id="engList"></div>
    </div>
    <div class="fsm-box">
      <h3 style="margin:0 0 8px">Data</h3>
      <div class="fsm-row">
        <a class="fsm-btn" onclick="exportJobs()">Export Jobs</a>
        <label class="fsm-btn">Import Jobs<input type="file" accept=".json" onchange="importJobs(event)" style="display:none"/></label>
      </div>
    </div>
    <div class="fsm-footer">Mostlane Portal – FSM</div>
  </div>
</body></html>
