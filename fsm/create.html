<!doctype html>
<html><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Create Job</title>
  <link rel="stylesheet" href="../style.css"/>
  <link rel="icon" href="favicon.ico">
  <link rel="apple-touch-icon" href="icon-180.png">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#003366">
  <script>
    if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }
  </script>

  <style>
/* Portal-native FSM skin */
.fsm-body {
  background: #e6e8eb url('../Mostlane_Embossed.png') no-repeat fixed;
  background-size: 180% auto;
  margin: 0;
  min-height: 100vh;
  font-family: Arial, sans-serif;
}
.fsm-wrap {
  max-width: 820px;
  margin: 0 auto;
  padding: 16px;
  text-align: left;
}
.fsm-header {
  background-color: #003366; /* portal blue */
  color: #fff;
  border-radius: 8px;
  padding: 10px 14px;
  display:flex; align-items:center; gap:10px;
}
.fsm-header img { height: 38px; width: auto; }
.fsm-header .title { font-size: 18px; font-weight: 700; margin: 0; }
.fsm-box {
  background: rgba(255,255,255,0.60);
  border-radius: 12px;
  padding: 14px;
  margin: 16px 0;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
}
.fsm-grid2 { display: grid; grid-template-columns: 1fr; gap: 12px; }
@media (min-width: 720px) { .fsm-grid2 { grid-template-columns: 1fr 1fr; } }
.fsm-kpi { background: rgba(255,255,255,0.70); border-radius: 12px; padding: 12px; }
.fsm-kpi .v { font-weight: 800; font-size: 24px; }
.fsm-kpi .l { color: #5f6876; font-size: 12px; margin-top: 4px; }
.fsm-input, .fsm-select, .fsm-textarea {
  width: 100%; padding: 12px 14px; border-radius: 10px;
  border: 1px solid #d6dbe1; background: #fff; font-size: 15px;
}
.fsm-btn { display:inline-block; padding:12px 16px; border-radius: 10px; border:1px solid #003366;
           background:#e6f0fa; color:#003366; font-weight:700; text-decoration:none; }
.fsm-btn.primary { background:#003366; color:#fff; }
.fsm-row { display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
.fsm-card { background: rgba(255,255,255,0.70); border-radius: 12px; padding: 12px; margin: 10px 0; }
.fsm-meta { color:#5f6876; font-size:12px; }
.fsm-chip { font-size:12px; padding:6px 10px; border-radius:999px; color:#fff; font-weight:800; display:inline-block; }
.fsm-New { background:#9aa7b6 } .fsm-Assigned { background:#003366 } .fsm-InProgress { background:#f1a331 }
.fsm-Completed { background:#23966e } .fsm-OnHold { background:#7d8694 } .fsm-Cancelled { background:#a1a7b2 }
.fsm-footer { text-align:center; padding-bottom: 40px; color:#5f6876; font-size:12px }
</style>
  <script defer src="assets/app.js"></script>
  <script>
  function createJob(){
    const id=MFSM.newJobId();
    const job={ id,
      title:document.getElementById('title').value.trim(),
      site:document.getElementById('site').value.trim(),
      description:document.getElementById('desc').value.trim(),
      status:document.getElementById('status').value,
      slaHours:Number(document.getElementById('sla').value)||'',
      dueDate:document.getElementById('due').value? new Date(document.getElementById('due').value).toISOString():'',
      assignee:document.getElementById('assignee').value||'',
      createdAt:new Date().toISOString(), updatedAt:new Date().toISOString(), timeSpentMs:0, notes:[]
    };
    const arr=MFSM.loadJobs(); arr.push(job); MFSM.saveJobs(arr);
    const s=MFSM.loadSettings(); MFSM.postZap(s.webhookJobCreate, {event:'job_create', job});
    location.href='job.html?id='+id;
  }
  document.addEventListener('DOMContentLoaded',()=>{
    const engs=MFSM.loadEngineers();
    document.getElementById('assignee').innerHTML='<option value="">—</option>'+engs.map(e=>`<option value="${e.id}">${e.name}</option>`).join('');
  });
  </script>
</head>
<body class="fsm-body">
  <div class="fsm-wrap">
    
<div class="fsm-header">
  <img src="../mostlane-logo.jpg" alt="Mostlane logo"/>
  <h2 class="title">Create Job</h2>
</div>

    <div class="fsm-box">
      <div class="fsm-grid2">
        <div><div class="fsm-meta">Title</div><input id="title" class="fsm-input" placeholder="e.g., Replace DB"/></div>
        <div><div class="fsm-meta">Site</div><input id="site" class="fsm-input" placeholder="e.g., 006 Portsmouth Elm Grove"/></div>
        <div><div class="fsm-meta">Assignee</div><select id="assignee" class="fsm-select"></select></div>
        <div><div class="fsm-meta">Status</div><select id="status" class="fsm-select"><option>New</option><option>Assigned</option><option>In Progress</option></select></div>
        <div><div class="fsm-meta">SLA (h)</div><input id="sla" type="number" class="fsm-input"/></div>
        <div><div class="fsm-meta">Due</div><input id="due" type="datetime-local" class="fsm-input"/></div>
      </div>
      <div class="fsm-meta">Description</div>
      <textarea id="desc" class="fsm-textarea" rows="5" placeholder="Scope, materials, access notes..."></textarea>
      <div class="fsm-row" style="margin-top:10px"><a class="fsm-btn primary" onclick="createJob()">Create</a></div>
    </div>
    <div class="fsm-footer">Mostlane Portal – FSM</div>
  </div>
</body></html>
