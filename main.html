
<!DOCTYPE html>
<html>
<head>
  <title>Main Menu</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
<script>
  if (sessionStorage.getItem("mostlaneLoggedIn") !== "true") {
    window.location.href = "login.html";
  }
</script>

</head>
<body class="main-body">
  
<div id="statusBox" style="margin-bottom: 20px; font-weight: bold; color: #004a99;"></div>
<script>
  const currentUser = sessionStorage.getItem("mostlaneUser");
  const status = localStorage.getItem("mostlaneStatus_" + currentUser);
  const site = localStorage.getItem("mostlaneSite_" + currentUser);
  const timestamp = localStorage.getItem("mostlaneTimestamp_" + currentUser);
  let statusText = "Status unknown";
  if (status === "checked-in") {
    statusText = "Checked In" + (site ? ` at ${site}` : "");
  } else if (status === "checked-out") {
    statusText = "Last Checkout: " + (timestamp ? timestamp : "unknown time");
    if (site) statusText += " at " + site;
  }
  document.getElementById("statusBox").textContent = "Current Status: " + statusText;
</script>

<div id="user-display" style="margin-bottom: 20px; font-size: 16px; font-weight: bold; color: #003366;"></div>
  <script>
    const user = sessionStorage.getItem("mostlaneUser");
    if (user) {
      document.getElementById("user-display").textContent = "You are logged in as " + user;
    }
  </script>

  <style>
    .main-body {
      font-family: "Segoe UI", sans-serif;
      background: #e6e8eb url('Mostlane_Embossed.png') no-repeat center center fixed;
      background-size: 180%;
      margin: 0;
      padding: 40px 20px;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      color: #003366;
      margin-bottom: 30px;
      text-align: center;
    }
    .button {
      display: block;
      margin: 10px auto;
      padding: 12px 20px;
      font-size: 16px;
      text-align: center;
      color: #ffffff;
      background-color: rgba(0, 74, 153, 0.6);
      text-decoration: none;
      border-radius: 6px;
      width: 90%;
      max-width: 300px;
    }
  </style>
  
  <a class="button" href="index.html">Check In / Out</a>
    <a class="button" href="fuel.html">Fuel & Expenses</a>
  <a class="button" href="holiday.html">Holiday Requests</a>
  <a class="button" href="my-assets.html">Plant & Equipment</a>
  <a class="button" href="shared-assets.html">Shared Assets</a>

  <a class="button" id="hrButton" href="#">HR Documents</a>
  <a class="button" href="purchase.html">Generate Purchase Order Reference</a>
  <a class="button" href="weekly.html">Weekly Summary</a>

<a class="button" href="#" onclick="sessionStorage.removeItem('mostlaneLoggedIn'); window.location.href='login.html';">Logout</a>

<script>
  const folder = sessionStorage.getItem("mostlaneFolder");
  const hrButton = document.getElementById("hrButton");
  if (folder) {
    hrButton.href = folder;
    hrButton.target = "_blank";
  } else {
    hrButton.addEventListener("click", function(e) {
      e.preventDefault();
      alert("No folder assigned. Please log in again.");
    });
  }
</script>

<script>
  fetch("https://raw.githubusercontent.com/Mostlane/Test/main/role-type.txt")
    .then(r => r.text())
    .then(text => {
      const lines = text.split("\n");
      const user = sessionStorage.getItem("mostlaneUser");
      const match = lines.find(line => line.includes(user));
      const isOffice = match && match.includes("Office");
      if (isOffice) {
        const btn = document.createElement("a");
        btn.className = "button";
        btn.href = "add-site.html";
        btn.textContent = "Add Site";
        document.querySelector("a[href='weekly.html']").insertAdjacentElement("afterend", btn);
      }
    });
</script>

</body>
</html>
