<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mostlane • SLA Scheduler</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="auth.js"></script>
  <style>
    :root{
      --ml-blue:#003b82;
      --ml-blue-light:#1e66ff;
      --bg:#e6e8eb;
      --panel:rgba(255,255,255,0.94);
      --text:#0f172a;
      --muted:#6b7280;
      --danger:#dc2626;
      --grid-line:#e5e7eb;
    }

    html,body{
      margin:0;
      padding:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background: var(--bg) url('Mostlane_Embossed.png') no-repeat center center fixed;
      background-size:180%;
    }

    .shell{
      max-width:1100px;
      margin:24px auto;
      padding:0 16px 24px;
    }

    .card{
      background:var(--panel);
      border-radius:14px;
      padding:18px 18px 20px;
      box-shadow:0 12px 28px rgba(0,0,0,0.12);
      border:1px solid rgba(15,23,42,0.06);
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:14px;
    }

    header h1{
      margin:0;
      font-size:20px;
      color:var(--ml-blue);
    }

    .sub{
      font-size:12px;
      color:var(--muted);
      margin-top:2px;
    }

    a.back-btn{
      text-decoration:none;
      font-size:13px;
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,0.1);
      background:#fff;
      color:var(--ml-blue);
      display:inline-flex;
      align-items:center;
      gap:4px;
    }

    .toolbar{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
      font-size:13px;
    }

    .toolbar-group{
      display:flex;
      align-items:center;
      gap:6px;
      flex-wrap:wrap;
    }

    .chip-group{
      display:inline-flex;
      border-radius:999px;
      background:#e5e7eb;
      padding:2px;
    }
    .chip{
      padding:4px 10px;
      border-radius:999px;
      font-size:12px;
      border:none;
      background:transparent;
      color:#4b5563;
      cursor:pointer;
    }
    .chip.active{
      background:#fff;
      color:var(--ml-blue);
      box-shadow:0 0 0 1px rgba(15,23,42,0.06);
    }

    select, input[type="date"]{
      padding:6px 8px;
      border-radius:999px;
      border:1px solid rgba(15,23,42,0.14);
      font-size:12px;
      background:#fff;
    }

    /* Scheduler layout */
    .scheduler-wrapper{
      margin-top:8px;
      border-radius:12px;
      border:1px solid rgba(15,23,42,0.08);
      overflow:hidden;
      background:#f9fafb;
    }

    .scheduler-header{
      display:grid;
      grid-template-columns:160px 1fr;
      background:#f3f4f6;
      border-bottom:1px solid var(--grid-line);
    }

    .scheduler-header-left{
      padding:8px 10px;
      font-size:12px;
      color:var(--muted);
    }

    .scheduler-header-grid{
      position:relative;
      overflow:hidden;
    }

    .scheduler-hours{
      display:flex;
      font-size:11px;
      color:var(--muted);
    }
    .scheduler-hours div{
      flex:1;
      text-align:center;
      padding:4px 0;
      border-left:1px solid var(--grid-line);
    }

    .scheduler-body{
      max-height:480px;
      overflow:auto;
    }

    .lane{
      display:grid;
      grid-template-columns:160px 1fr;
      border-bottom:1px solid var(--grid-line);
      background:#fff;
    }

    .lane:nth-child(odd){
      background:#fdfdfd;
    }

    .lane-left{
      padding:8px 10px;
      border-right:1px solid var(--grid-line);
      font-size:12px;
      display:flex;
      flex-direction:column;
      justify-content:center;
    }

    .lane-engineer{
      font-weight:600;
      color:var(--ml-blue);
    }

    .lane-meta{
      font-size:11px;
      color:var(--muted);
    }

    .lane-grid{
      position:relative;
      min-height:50px;
      background-image:linear-gradient(to right, transparent 0, transparent calc(100%/14 - 0.5px), var(--grid-line) calc(100%/14 - 0.5px));
      background-size:calc(100%/14) 100%;
    }

    .job-block{
      position:absolute;
      top:7px;
      height:36px;
      border-radius:8px;
      padding:4px 8px;
      font-size:11px;
      color:#fff;
      background:linear-gradient(135deg,#1d4ed8,#2563eb);
      box-shadow:0 4px 10px rgba(15,23,42,0.35);
      cursor:grab;
      display:flex;
      flex-direction:column;
      overflow:hidden;
    }
    .job-block.dragging{
      opacity:0.85;
      cursor:grabbing;
      z-index:20;
    }
    .job-title{
      font-weight:600;
      white-space:nowrap;
      text-overflow:ellipsis;
      overflow:hidden;
    }
    .job-meta{
      font-size:10px;
      opacity:0.9;
      display:flex;
      justify-content:space-between;
      gap:4px;
    }
    .job-priority-high{
      background:linear-gradient(135deg,#b91c1c,#ef4444);
    }

    .no-jobs{
      font-size:11px;
      color:var(--muted);
      padding:14px 10px;
    }

    /* Modal */
    .modal-backdrop{
      position:fixed;
      inset:0;
      background:rgba(15,23,42,0.55);
      display:none;
      align-items:center;
      justify-content:center;
      z-index:9999;
    }

    .modal{
      background:#fff;
      border-radius:14px;
      padding:16px 16px 18px;
      width:calc(100% - 40px);
      max-width:420px;
      box-shadow:0 20px 40px rgba(15,23,42,0.45);
      font-size:13px;
    }

    .modal h2{
      margin:0 0 6px;
      font-size:16px;
      color:var(--ml-blue);
    }

    .modal-sub{
      font-size:11px;
      color:var(--muted);
      margin-bottom:8px;
    }

    .modal label{
      display:block;
      font-size:12px;
      font-weight:600;
      margin-top:10px;
    }

    .modal input,
    .modal select,
    .modal textarea{
      width:100%;
      margin-top:4px;
      padding:6px 8px;
      border-radius:6px;
      border:1px solid rgba(15,23,42,0.18);
      font-size:12px;
      box-sizing:border-box;
    }

    .modal textarea{
      min-height:60px;
      resize:vertical;
    }

    .engineer-list{
      margin-top:4px;
      max-height:110px;
      overflow:auto;
      border:1px solid rgba(15,23,42,0.18);
      border-radius:8px;
      padding:6px 8px;
    }

    .engineer-list-item{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:12px;
      padding:2px 0;
    }

    .modal-actions{
      display:flex;
      justify-content:space-between;
      gap:8px;
      margin-top:14px;
    }

    .btn{
      flex:1;
      padding:8px 10px;
      border-radius:999px;
      border:none;
      font-size:12px;
      cursor:pointer;
    }

    .btn-primary{
      background:linear-gradient(135deg,#1d4ed8,#1e40af);
      color:#fff;
    }

    .btn-secondary{
      background:#e5e7eb;
      color:#111827;
    }

    .btn-danger{
      background:var(--danger);
      color:#fff;
    }

    .empty-msg{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="card">
    <header>
      <div>
        <h1>SLA Scheduler</h1>
        <div class="sub" id="userLabel"></div>
      </div>
      <a href="sla-menu.html" class="back-btn">← Back</a>
    </header>

    <div class="toolbar">
      <div class="toolbar-group">
        <span style="font-size:12px;color:var(--muted);">View</span>
        <div class="chip-group" id="viewModeGroup">
          <button class="chip active" data-view="day">Day</button>
          <button class="chip" data-view="week">Week</button>
        </div>
      </div>

      <div class="toolbar-group">
        <span style="font-size:12px;color:var(--muted);">Engineer</span>
        <select id="engineerFilter">
          <option value="all">All engineers</option>
        </select>
      </div>

      <div class="toolbar-group">
        <span style="font-size:12px;color:var(--muted);">Date</span>
        <input type="date" id="datePicker">
      </div>

      <div class="toolbar-group" style="margin-left:auto;">
        <span id="statusMsg" style="font-size:11px;color:var(--muted);">Loading engineers…</span>
      </div>
    </div>

    <div class="scheduler-wrapper" id="schedulerWrapper">
      <div class="scheduler-header">
        <div class="scheduler-header-left">Engineer</div>
        <div class="scheduler-header-grid">
          <div class="scheduler-hours" id="hoursHeader"></div>
        </div>
      </div>
      <div class="scheduler-body" id="lanesContainer">
        <!-- Lanes injected here -->
      </div>
    </div>

    <div class="empty-msg" id="emptyMsg" style="display:none;">
      No jobs to show for this period.
    </div>
  </div>
</div>

<!-- Job Detail Modal -->
<div class="modal-backdrop" id="jobModalBackdrop">
  <div class="modal">
    <h2 id="modalTitle">Job details</h2>
    <div class="modal-sub" id="modalSub"></div>

    <label for="modalSummary">Summary</label>
    <input id="modalSummary" type="text">

    <label for="modalPriority">Priority</label>
    <select id="modalPriority">
      <option value="Normal">Normal</option>
      <option value="High">High</option>
    </select>

    <label>Assigned engineers (tick to multi-assign)</label>
    <div class="engineer-list" id="modalEngineerList">
      <!-- checkboxes injected -->
    </div>

    <label for="modalNotes">Notes</label>
    <textarea id="modalNotes"></textarea>

    <div class="modal-actions">
      <button class="btn btn-secondary" id="modalCancelBtn">Close</button>
      <button class="btn btn-primary" id="modalSaveBtn">Save</button>
    </div>
  </div>
</div>

<script>
  const USERS_ENDPOINT = "https://mostlane-users.jamie-def.workers.dev/all";
  // TODO: replace with your real SLA jobs endpoint when ready:
  const JOBS_ENDPOINT  = "https://mostlane-sla.jamie-def.workers.dev/jobs"; // example / placeholder path

  const byId = id => document.getElementById(id);

  let engineers = []; // {id, name}
  let jobs = [];      // {id, title, engineerId, start, end, priority, notes, engineers[]}
  let viewMode = "day"; // 'day' or 'week'
  let currentDate = new Date();
  let dragState = null; // {jobId, engineerId, offsetPercent, widthPercent}

  // ------------- Dates / time helpers -------------
  function toISODate(d){
    return d.toISOString().split("T")[0];
  }

  function hoursRange(view){
    return view === "day"
      ? {start:7, end:19, slots:12} // 12 hours
      : {start:6, end:20, slots:14}; // 14 hours
  }

  function buildHoursHeader(){
    const hdr = byId("hoursHeader");
    hdr.innerHTML = "";
    const cfg = hoursRange(viewMode);
    const span = cfg.end - cfg.start;
    for(let h = cfg.start; h < cfg.end; h++){
      const div = document.createElement("div");
      const label = (h < 10 ? "0" : "") + h + ":00";
      div.textContent = label;
      hdr.appendChild(div);
    }
  }

  // Convert date+time fraction (0-1 across visible span) to actual Date
  function dateFromFraction(baseDate, fraction){
    const cfg = hoursRange(viewMode);
    const span = cfg.end - cfg.start;
    const hour = cfg.start + fraction * span;
    const d = new Date(baseDate);
    d.setHours(Math.floor(hour), (hour%1)*60, 0, 0);
    return d;
  }

  function fractionFromDate(d){
    const cfg = hoursRange(viewMode);
    const h = d.getHours() + d.getMinutes()/60;
    const span = cfg.end - cfg.start;
    return Math.min(1, Math.max(0,(h - cfg.start)/span));
  }

  // Format job times
  function fmtTime(d){
    const hh = String(d.getHours()).padStart(2,"0");
    const mm = String(d.getMinutes()).padStart(2,"0");
    return hh + ":" + mm;
  }

  // ------------- Data fetch -------------
  async function loadEngineers(){
    try{
      const res = await fetch(USERS_ENDPOINT, {cache:"no-store"});
      const data = await res.json();

      const rawList = Array.isArray(data) ? data : (data.users || data.data || []);
      engineers = rawList
        .map(u=>{
          const id = u.Username || u.username || u.User || u.user;
          if(!id) return null;
          const nameRaw = u.DisplayName || u.displayName || id;
          const name = nameRaw.replace(/\./g," ");
          return { id, name };
        })
        .filter(Boolean)
        .sort((a,b)=>a.name.localeCompare(b.name));

      const sel = byId("engineerFilter");
      sel.innerHTML = '<option value="all">All engineers</option>';
      engineers.forEach(e=>{
        const o = document.createElement("option");
        o.value = e.id;
        o.textContent = e.name;
        sel.appendChild(o);
      });

      if(!engineers.length){
        byId("statusMsg").textContent = "No engineers found.";
      } else {
        byId("statusMsg").textContent = "Loaded " + engineers.length + " engineers.";
      }

    }catch(err){
      console.error(err);
      byId("statusMsg").textContent = "Failed to load engineers.";
      engineers = [];
    }
  }

  async function loadJobs(){
    // If you haven't wired the jobs worker yet, this will fail; in that case,
    // we fall back to some simple in-memory demo jobs so the scheduler still works.
    try{
      const res = await fetch(JOBS_ENDPOINT + "?date=" + encodeURIComponent(toISODate(currentDate)) + "&view=" + viewMode, {cache:"no-store"});
      if(!res.ok) throw new Error("Jobs endpoint not ready");
      const data = await res.json();
      const list = Array.isArray(data) ? data : (data.jobs || data.data || []);
      jobs = list.map(j => normalizeJob(j));
      byId("statusMsg").textContent = "Jobs loaded.";
    }catch(err){
      console.warn("Jobs endpoint error, using demo jobs:", err.message);
      const dayStart = new Date(currentDate);
      dayStart.setHours(9,0,0,0);
      const d2 = new Date(dayStart); d2.setHours(13);
      const d3 = new Date(dayStart); d3.setHours(15);
      const e1 = engineers[0]?.id;
      const e2 = engineers[1]?.id || e1;
      jobs = [
        {
          id:"DEMO-001",
          title:"Leak at 0307 Winchester",
          engineerId:e1,
          start:dayStart,
          end:d2,
          priority:"High",
          notes:"",
          engineers:[e1]
        },
        {
          id:"DEMO-002",
          title:"EM test – Lakeside",
          engineerId:e2,
          start:d2,
          end:d3,
          priority:"Normal",
          notes:"",
          engineers:[e2]
        }
      ];
      byId("statusMsg").textContent = "Demo jobs (endpoint not wired yet).";
    }
  }

  function normalizeJob(j){
    const id = j.id || j.jobId || j.reference || ("JOB-" + Math.random().toString(36).slice(2,8));
    const engineerId = j.engineerId || j.engineer || j.assignedTo || (j.engineers && j.engineers[0]);
    const start = j.start ? new Date(j.start) : new Date();
    const end = j.end ? new Date(j.end) : new Date(start.getTime() + 60*60*1000);
    const title = j.title || j.summary || ("Job " + id);
    const priority = j.priority || "Normal";
    const notes = j.notes || "";
    const engArr = Array.isArray(j.engineers) ? j.engineers : (engineerId ? [engineerId] : []);
    return { id, engineerId, start, end, title, priority, notes, engineers: engArr };
  }

  // ------------- Rendering -------------
  function renderScheduler(){
    buildHoursHeader();
    const container = byId("lanesContainer");
    container.innerHTML = "";

    const filterEngineer = byId("engineerFilter").value;
    const visibleEngineers = filterEngineer === "all"
      ? engineers
      : engineers.filter(e=>e.id === filterEngineer);

    if(!visibleEngineers.length){
      container.innerHTML = '<div class="no-jobs">No engineers available.</div>';
      return;
    }

    const cfg = hoursRange(viewMode);

    // Filter jobs for the current view
    const startOfDay = new Date(currentDate);
    startOfDay.setHours(0,0,0,0);
    const endOfDay = new Date(startOfDay); endOfDay.setDate(endOfDay.getDate()+1);

    function jobInView(j){
      if(viewMode === "day"){
        return j.start < endOfDay && j.end > startOfDay;
      } else {
        const startWeek = new Date(startOfDay);
        const endWeek = new Date(startOfDay); endWeek.setDate(endWeek.getDate()+7);
        return j.start < endWeek && j.end > startWeek;
      }
    }

    const jobsInView = jobs.filter(jobInView);
    byId("emptyMsg").style.display = jobsInView.length ? "none" : "block";

    visibleEngineers.forEach(eng=>{
      const lane = document.createElement("div");
      lane.className = "lane";
      lane.dataset.engineerId = eng.id;

      const left = document.createElement("div");
      left.className = "lane-left";
      const nameDiv = document.createElement("div");
      nameDiv.className = "lane-engineer";
      nameDiv.textContent = eng.name;
      const metaDiv = document.createElement("div");
      metaDiv.className = "lane-meta";
      metaDiv.textContent = eng.id;
      left.appendChild(nameDiv);
      left.appendChild(metaDiv);

      const grid = document.createElement("div");
      grid.className = "lane-grid";

      const engJobs = jobsInView.filter(j => j.engineerId === eng.id);
      if(!engJobs.length){
        const msg = document.createElement("div");
        msg.className = "no-jobs";
        msg.textContent = "No jobs.";
        msg.style.padding = "10px";
        grid.appendChild(msg);
      } else {
        engJobs.forEach(job=>{
          const block = document.createElement("div");
          block.className = "job-block";
          if(job.priority === "High") block.classList.add("job-priority-high");
          block.dataset.jobId = job.id;
          block.dataset.engineerId = eng.id;

          const fracStart = fractionFromDate(job.start);
          const fracEnd   = fractionFromDate(job.end);
          const leftPct   = fracStart * 100;
          const widthPct  = Math.max(6, (fracEnd - fracStart) * 100);

          block.style.left = leftPct + "%";
          block.style.width = widthPct + "%";

          const titleDiv = document.createElement("div");
          titleDiv.className = "job-title";
          titleDiv.textContent = job.title;

          const metaDiv2 = document.createElement("div");
          metaDiv2.className = "job-meta";
          metaDiv2.innerHTML = `
            <span>${fmtTime(job.start)}–${fmtTime(job.end)}</span>
            <span>${job.priority}</span>
          `;

          block.appendChild(titleDiv);
          block.appendChild(metaDiv2);

          // Drag behaviour
          block.addEventListener("pointerdown", e=>{
            e.preventDefault();
            const rect = grid.getBoundingClientRect();
            const startX = e.clientX;
            const offsetPct = ((startX - rect.left)/rect.width) * 100 - leftPct;
            dragState = {
              jobId: job.id,
              engineerId: eng.id,
              laneEl: grid,
              initialLeftPct: leftPct,
              widthPct,
              offsetPct
            };
            block.classList.add("dragging");
            block.setPointerCapture(e.pointerId);
          });

          block.addEventListener("pointermove", e=>{
            if(!dragState || dragState.jobId !== job.id) return;
            const rect = grid.getBoundingClientRect();
            const x = e.clientX;
            let newLeftPct = ((x - rect.left)/rect.width)*100 - dragState.offsetPct;
            newLeftPct = Math.max(0, Math.min(100 - dragState.widthPct, newLeftPct));
            block.style.left = newLeftPct + "%";
          });

          block.addEventListener("pointerup", e=>{
            if(!dragState || dragState.jobId !== job.id) return;
            block.releasePointerCapture(e.pointerId);
            block.classList.remove("dragging");

            const rect = dragState.laneEl.getBoundingClientRect();
            const x = e.clientX;
            let newLeftPct = ((x - rect.left)/rect.width)*100 - dragState.offsetPct;
            newLeftPct = Math.max(0, Math.min(100 - dragState.widthPct, newLeftPct));
            const fracStartNew = newLeftPct / 100;
            const newStart = dateFromFraction(currentDate, fracStartNew);
            const dur = job.end - job.start;
            const newEnd = new Date(newStart.getTime() + dur);

            // Check if pointer ended over a different lane for engineer change
            const targetLane = document.elementFromPoint(e.clientX, e.clientY)?.closest(".lane");
            const newEngineerId = targetLane?.dataset.engineerId || eng.id;

            job.start = newStart;
            job.end   = newEnd;
            job.engineerId = newEngineerId;

            // If multi-assign array exists, ensure main engineerId present
            if(Array.isArray(job.engineers) && !job.engineers.includes(newEngineerId)){
              job.engineers.push(newEngineerId);
            }

            dragState = null;
            renderScheduler();
            saveJobUpdate(job);
          });

          // Click to open modal
          block.addEventListener("click", e=>{
            // Ignore click immediately after drag (small heuristic)
            if(dragState) return;
            openJobModal(job);
          });

          grid.appendChild(block);
        });
      }

      lane.appendChild(left);
      lane.appendChild(grid);
      container.appendChild(lane);
    });
  }

  // ------------- Modal -------------
  let modalJob = null;

  function openJobModal(job){
    modalJob = job;
    byId("modalTitle").textContent = job.title;
    byId("modalSub").textContent = job.id + " • " + fmtTime(job.start) + "–" + fmtTime(job.end);

    byId("modalSummary").value = job.title;
    byId("modalPriority").value = job.priority || "Normal";
    byId("modalNotes").value = job.notes || "";

    const list = byId("modalEngineerList");
    list.innerHTML = "";
    const jobEngs = Array.isArray(job.engineers) ? job.engineers : (job.engineerId ? [job.engineerId] : []);
    engineers.forEach(e=>{
      const row = document.createElement("label");
      row.className = "engineer-list-item";
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.value = e.id;
      cb.checked = jobEngs.includes(e.id);
      const span = document.createElement("span");
      span.textContent = e.name;
      row.appendChild(cb);
      row.appendChild(span);
      list.appendChild(row);
    });

    byId("jobModalBackdrop").style.display = "flex";
  }

  function closeJobModal(){
    modalJob = null;
    byId("jobModalBackdrop").style.display = "none";
  }

  async function saveJobUpdate(job){
    // Placeholder: when you have an SLA worker endpoint for updates, call it here.
    // Example:
    // await fetch("https://mostlane-sla.jamie-def.workers.dev/job/update", {
    //   method:"POST",
    //   headers:{"Content-Type":"application/json"},
    //   body:JSON.stringify(jobToPayload(job))
    // });
    console.log("Job updated:", job);
  }

  function jobToPayload(job){
    return {
      id: job.id,
      title: job.title,
      engineerId: job.engineerId,
      engineers: job.engineers,
      start: job.start.toISOString(),
      end: job.end.toISOString(),
      priority: job.priority,
      notes: job.notes
    };
  }

  // ------------- Events -------------
  function attachEvents(){
    // View mode chips
    byId("viewModeGroup").addEventListener("click", e=>{
      const chip = e.target.closest(".chip");
      if(!chip) return;
      const mode = chip.dataset.view;
      if(!mode || mode === viewMode) return;
      viewMode = mode;
      [...byId("viewModeGroup").querySelectorAll(".chip")].forEach(c=>c.classList.remove("active"));
      chip.classList.add("active");
      renderScheduler();
    });

    byId("engineerFilter").addEventListener("change", ()=>{
      renderScheduler();
    });

    byId("datePicker").addEventListener("change", e=>{
      const val = e.target.value;
      if(!val) return;
      currentDate = new Date(val + "T00:00:00");
      loadJobs().then(renderScheduler);
    });

    byId("modalCancelBtn").addEventListener("click", closeJobModal);

    byId("modalSaveBtn").addEventListener("click", async ()=>{
      if(!modalJob) return;
      modalJob.title = byId("modalSummary").value.trim() || modalJob.title;
      modalJob.priority = byId("modalPriority").value;
      modalJob.notes = byId("modalNotes").value;

      const checks = [...byId("modalEngineerList").querySelectorAll("input[type=checkbox]")];
      const selected = checks.filter(c=>c.checked).map(c=>c.value);
      if(selected.length){
        modalJob.engineers = selected;
        if(!selected.includes(modalJob.engineerId)){
          modalJob.engineerId = selected[0];
        }
      }

      await saveJobUpdate(modalJob);
      renderScheduler();
      closeJobModal();
    });

    byId("jobModalBackdrop").addEventListener("click", e=>{
      if(e.target === byId("jobModalBackdrop")){
        closeJobModal();
      }
    });
  }

  // ------------- Init -------------
  async function init(){
    const user = sessionStorage.getItem("mostlaneUser");
    if(!user){
      window.location.href = "login.html";
      return;
    }
    byId("userLabel").textContent = "Logged in as " + user;

    byId("datePicker").value = toISODate(currentDate);

    attachEvents();
    await loadEngineers();
    await loadJobs();
    renderScheduler();
  }

  document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
