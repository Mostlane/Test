<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Create Purchase Order</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #e6e8eb url('Mostlane_Embossed.png') no-repeat center center fixed;
      background-size: 180%;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 600px;
      margin: 40px auto;
      background: rgba(255,255,255,0.6);
      padding: 20px;
      border-radius: 8px;
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, select, textarea, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 14px;
    }
    button {
      background-color: #004080;
      color: white;
      font-weight: bold;
      cursor: pointer;
      margin-top: 20px;
    }
    button:hover {
      background-color: #0066cc;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Create Purchase Order</h1>
    <form id="poForm">
      <label for="engineer">Engineer Name</label>
      <input type="text" id="engineer" name="engineer" readonly>

      <label for="date">Date</label>
      <input type="date" id="date" name="date" readonly>

      <label for="workType">Work Type</label>
      <select id="workType" name="workType" required>
        <option value="">-- Select Work Type --</option>
        <option value="Reactive">Reactive</option>
        <option value="Planned">Planned</option>
        <option value="Vehicle Maintenance">Vehicle Maintenance</option>
      </select>

      <div id="incidentField" style="display:none;">
        <label for="incident">Incident Number</label>
        <input type="text" id="incident" name="incident">
      </div>

      <div id="siteField">
        <label for="site">Site</label>
        <select id="site" name="site" required>
          <option value="">-- Select Site --</option>
        </select>
      </div>

      <div id="vehicleField" style="display:none;">
        <label for="vehicle">Vehicle</label>
        <select id="vehicle" name="vehicle">
          <option value="">-- Select Vehicle --</option>
        </select>
      </div>

      <label for="supplier">Supplier</label>
      <select id="supplier" name="supplier" required>
        <option value="">-- Select Supplier --</option>
      </select>

      <label for="description">Short Description</label>
      <textarea id="description" name="description" required></textarea>

      <button type="submit">Submit</button>
    </form>
  </div>

  <script>
    // Autofill engineer
    const username = sessionStorage.getItem("mostlaneUsername");
    if (username) {
      document.getElementById("engineer").value = username.replace(".", " ");
    }

    // Autofill today's date
    const today = new Date().toISOString().split('T')[0];
    document.getElementById("date").value = today;

    // Toggle incident/site/vehicle fields
    document.getElementById("workType").addEventListener("change", function() {
      const type = this.value;
      document.getElementById("incidentField").style.display = (type === "Reactive") ? "block" : "none";
      document.getElementById("siteField").style.display = (type === "Vehicle Maintenance") ? "none" : "block";
      document.getElementById("vehicleField").style.display = (type === "Vehicle Maintenance") ? "block" : "none";
    });

    // Fetch Sites
    fetch('https://raw.githubusercontent.com/Mostlane/Test/main/sites.json?v=' + new Date().getTime())
      .then(res => res.json())
      .then(data => {
        const siteSelect = document.getElementById('site');
        siteSelect.innerHTML = '<option value="">-- Select Site --</option>';
        data.forEach(site => {
          const opt = document.createElement('option');
          opt.value = site.siteName;
          opt.textContent = site.siteName;
          siteSelect.appendChild(opt);
        });
      });

    // Fetch Suppliers
    fetch('https://raw.githubusercontent.com/Mostlane/Test/main/suppliers.json?v=' + new Date().getTime())
      .then(res => res.json())
      .then(data => {
        const supplierSelect = document.getElementById('supplier');
        supplierSelect.innerHTML = '<option value="">-- Select Supplier --</option>';
        data.forEach(s => {
          const opt = document.createElement('option');
          opt.value = s.supplierName; // only supplier name
          opt.textContent = s.supplierName;
          supplierSelect.appendChild(opt);
        });
      });

    // Fetch Vehicles
    fetch('https://raw.githubusercontent.com/Mostlane/Test/main/vehicles.json?v=' + new Date().getTime())
      .then(res => res.json())
      .then(data => {
        const vehicleSelect = document.getElementById('vehicle');
        vehicleSelect.innerHTML = '<option value="">-- Select Vehicle --</option>';
        data.forEach(v => {
          const opt = document.createElement('option');
          opt.value = v.reg;
          opt.textContent = v.reg;
          vehicleSelect.appendChild(opt);
        });
      });

    // Form validation
    document.getElementById("poForm").addEventListener("submit", function(e) {
      const workType = document.getElementById("workType").value;
      const incident = document.getElementById("incident").value.trim();
      const description = document.getElementById("description").value.trim();
      if (!description) {
        alert("Short Description is required.");
        e.preventDefault();
        return;
      }
      if (workType === "Reactive" && !incident) {
        alert("Incident Number is required for Reactive jobs.");
        e.preventDefault();
      }
    });
  </script>
</body>
</html>
