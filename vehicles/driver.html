<!doctype html>
<html><head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>My Vehicle</title>
  <link rel="stylesheet" href="../style.css"/>
  <link rel="icon" href="favicon.ico"><link rel="apple-touch-icon" href="icon-180.png"><link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#003366">
  <style>
  .v-body{background:#e6e8eb url('../Mostlane_Embossed.png') no-repeat fixed center/180% auto; margin:0; min-height:100vh; font-family:Arial,sans-serif}
  .wrap{max-width:980px;margin:0 auto;padding:16px}
  .hdr{background:#003366;color:#fff;border-radius:8px;padding:10px 14px;display:flex;align-items:center;gap:10px}
  .hdr img{height:38px;width:auto} .hdr .t{font-size:18px;font-weight:700;margin:0}
  .btn{display:inline-block;padding:10px 14px;border-radius:10px;border:1px solid #003366;background:#e6f0fa;color:#003366;font-weight:700;text-decoration:none;white-space:nowrap}
  .btn.primary{background:#003366;color:#fff}
  .box{background:rgba(255,255,255,.60);border-radius:12px;padding:16px;margin:16px 0;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  .grid{display:grid;grid-template-columns:1fr;gap:12px}
  @media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:rgba(255,255,255,.7);border-radius:12px;padding:12px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  .meta{color:#5f6876;font-size:12px}
  .input,.select,.textarea{width:100%;padding:12px 14px;border-radius:10px;border:1px solid #d6dbe1;background:#fff;font-size:15px}
  table{width:100%;border-collapse:collapse;font-size:14px} th,td{padding:8px;border-bottom:1px dashed #dfe3ea;text-align:left}
  </style>
  <script>if('serviceWorker' in navigator){ navigator.serviceWorker.register('sw.js').catch(()=>{}); }</script>
  <script defer src="assets/vehicles.js"></script>
</head>
<body class="v-body">
  <div class="wrap" id="wrap">
    <div class="hdr">
      <img src="../mostlane-logo.jpg" alt="Mostlane logo"/><h2 class="t" id="title">My Vehicle</h2>
      <div style="margin-left:auto"><a class="btn primary" href="index.html">Back</a></div>
    </div>
    <div class="box">
      <div id="summary"></div>
      <div class="row" style="margin-top:10px">
        <a id="vancheck" class="btn primary" target="_blank" rel="noopener">Open Van Check Form</a>
      </div>
    </div>
  </div>
<script>
function load(){
  const u=new URL(location.href);
  const driverId=u.searchParams.get('driver')||'';
  const vs=v_loadVehicles();
  const v=vs.find(x=> (x.driverId||'')===driverId);
  if(!v){ document.getElementById('wrap').innerHTML='<div class="box">No vehicle assigned.</div>'; return; }
  const c=v_costs(v.reg), miles=v_miles(v.reg);
  document.getElementById('title').textContent='My Vehicle · '+v.reg;
  document.getElementById('summary').innerHTML=`
    <div class="row" style="justify-content:space-between">
      <strong>${v.reg}</strong><span>${v.make||''} ${v.model||''}</span>
    </div>
    <div class="meta">Service interval: ${v.serviceInterval||'—'}</div>
    <div class="meta">Mileage: ${miles.toLocaleString()} mi</div>
    <div class="meta">Costs: Fuel £${c.fuel.toFixed(2)} · Service £${c.serv.toFixed(2)} · Tyres £${c.tyre.toFixed(2)} · Claims £${c.claims.toFixed(2)}</div>`;
  const s=v_settings();
  const link=document.getElementById('vancheck');
  if(s.jotformVanCheckURL){ link.href=s.jotformVanCheckURL + (s.jotformVanCheckURL.includes('?')?'&':'?') + 'reg='+encodeURIComponent(v.reg)+'&driver='+encodeURIComponent(driverId); }
  else { link.textContent='Van Check form not configured'; link.style.opacity=0.6; link.style.pointerEvents='none'; }
}
document.addEventListener('DOMContentLoaded', load);
</script>
</body></html>
