
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mostlane Compliance Portal</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('Mostlane_Embossed.png') no-repeat center center fixed;
      background-size: cover;
      color: #003366;
    }
    header {
      background-color: rgba(255, 255, 255, 0.85);
      padding: 1rem;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    header img {
      max-height: 60px;
    }
    .summary {
      display: flex;
      justify-content: space-around;
      margin: 1rem auto;
      max-width: 1200px;
    }
    .summary-box {
      background: white;
      padding: 1rem;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      text-align: center;
      flex: 1;
      margin: 0 1rem;
    }
    .summary-box h2 {
      margin: 0.5rem 0;
    }
    .search-container {
      text-align: center;
      margin: 2rem;
    }
    input[type="text"] {
      padding: 0.5rem;
      width: 50%;
      font-size: 1rem;
      border-radius: 8px;
      border: 1px solid #ccc;
    }
    table {
      width: 90%;
      margin: 1rem auto;
      border-collapse: collapse;
      background-color: white;
    }
    th, td {
      padding: 0.75rem;
      text-align: left;
      border-bottom: 1px solid #ddd;
    }
    th {
      background-color: #e6f0ff;
    }
    tr:hover {
      background-color: #f1f9ff;
    }
    .due-soon { color: orange; }
    .overdue { color: red; font-weight: bold; }
    .ok { color: green; }
  </style>
</head>
<body>

<header>
  <img src="mostlane-logo.jpeg" alt="Mostlane Logo">
  <h1>Compliance Portal</h1>
</header>

<div class="summary">
  <div class="summary-box" id="satisfactoryBox"><h2>Satisfactory</h2><p id="satisfactoryCount">0</p></div>
  <div class="summary-box" id="unsatisfactoryBox"><h2>Unsatisfactory</h2><p id="unsatisfactoryCount">0</p></div>
  <div class="summary-box" id="overallStatusBox"><h2>Overall Status</h2><p id="overallStatus">-</p></div>
</div>

<div class="summary">
  <div class="summary-box"><h2>Due in 30 Days</h2><p id="due30">0</p></div>
  <div class="summary-box"><h2>Due in 90 Days</h2><p id="due90">0</p></div>
  <div class="summary-box"><h2>Due in 365 Days</h2><p id="due365">0</p></div>
</div>

<div class="search-container">
  <input type="text" id="searchBar" placeholder="Search site name or store number..." />
</div>

<table id="eicrTable">
  <thead>
    <tr>
      <th>Store Number</th>
      <th>Site Name</th>
      <th>Status</th>
      <th>EICR Due</th>
      <th>EM Lights</th>
      <th>PAT</th>
      <th>PV</th>
      <th>EV</th>
      <th>Forecourt</th>
      <th>Report</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function fetchData() {
  const res = await fetch('eicr-log.json');
  const data = await res.json();
  populateTable(data);
}

function formatDate(dateStr) {
  if (!dateStr) return "";
  const d = new Date(dateStr);
  return d.toLocaleDateString();
}

function getClassForDate(dateStr) {
  if (!dateStr) return '';
  const due = new Date(dateStr);
  const today = new Date();
  const diff = (due - today) / (1000 * 60 * 60 * 24);
  if (diff < 0) return 'overdue';
  if (diff <= 30) return 'due-soon';
  return 'ok';
}

function populateTable(data) {
  const tbody = document.querySelector("#eicrTable tbody");
  const search = document.getElementById("searchBar");
  const satisfactoryBox = document.getElementById("satisfactoryCount");
  const unsatisfactoryBox = document.getElementById("unsatisfactoryCount");
  const due30 = document.getElementById("due30");
  const due90 = document.getElementById("due90");
  const due365 = document.getElementById("due365");
  const statusBox = document.getElementById("overallStatus");

  let satisfactory = 0, unsatisfactory = 0;
  let d30 = 0, d90 = 0, d365 = 0;

  function renderTable(filteredData) {
    tbody.innerHTML = "";
    filteredData.forEach(site => {
      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${site.storeNumber}</td>
        <td>${site.siteName}</td>
        <td>${site.status}</td>
        <td class="${getClassForDate(site.eicrDue)}">${formatDate(site.eicrDue)}</td>
        <td class="${getClassForDate(site.emDue)}">${formatDate(site.emDue)}</td>
        <td class="${getClassForDate(site.patDue)}">${formatDate(site.patDue)}</td>
        <td class="${getClassForDate(site.pvDue)}">${formatDate(site.pvDue)}</td>
        <td class="${getClassForDate(site.evDue)}">${formatDate(site.evDue)}</td>
        <td class="${getClassForDate(site.forecourtDue)}">${formatDate(site.forecourtDue)}</td>
        <td><a href="${site.link}" target="_blank">View</a></td>
      `;
      tbody.appendChild(row);
    });
  }

  function calcStats() {
    data.forEach(site => {
      if (site.status === 'Satisfactory') satisfactory++;
      else unsatisfactory++;
      [site.eicrDue, site.emDue, site.patDue, site.pvDue, site.evDue, site.forecourtDue].forEach(dateStr => {
        if (!dateStr) return;
        const days = (new Date(dateStr) - new Date()) / (1000 * 60 * 60 * 24);
        if (days >= 0 && days <= 30) d30++;
        if (days >= 0 && days <= 90) d90++;
        if (days >= 0 && days <= 365) d365++;
      });
    });
    satisfactoryBox.textContent = satisfactory;
    unsatisfactoryBox.textContent = unsatisfactory;
    statusBox.textContent = unsatisfactory > 0 ? "Action Required" : "Compliant";
    due30.textContent = d30;
    due90.textContent = d90;
    due365.textContent = d365;
  }

  renderTable(data);
  calcStats();

  search.addEventListener("input", () => {
    const val = search.value.toLowerCase();
    const filtered = data.filter(s =>
      s.siteName.toLowerCase().includes(val) ||
      s.storeNumber.toString().includes(val)
    );
    renderTable(filtered);
  });
}

fetchData();
</script>

</body>
</html>
