
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>EICR Compliance Portal</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: url('Mostlane_Embossed.png') no-repeat center center fixed;
      background-size: cover;
    }
    .container {
      background: rgba(255, 255, 255, 0.85); /* Increased transparency */
      margin: 40px auto;
      padding: 20px;
      border-radius: 12px;
      max-width: 1200px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }
    h1 {
      text-align: center;
      margin-bottom: 20px;
    }
    .logo {
      display: block;
      margin: 0 auto 20px;
      max-width: 160px;
    }
    .summary-buttons {
      display: flex;
      justify-content: space-around;
      margin-bottom: 20px;
    }
    .summary-buttons button {
      padding: 10px 20px;
      border: none;
      border-radius: 20px;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .search-bar {
      text-align: center;
      margin-bottom: 20px;
    }
    #searchInput {
      padding: 8px;
      width: 300px;
      border-radius: 10px;
      border: 1px solid #ccc;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 8px 12px;
      border-bottom: 1px solid #ddd;
      text-align: center;
      white-space: nowrap;
    }
    th {
      background-color: #f4f4f4;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="mostlane-logo.jpg" alt="Mostlane Logo" class="logo">
    <h1>Compliance Tracker</h1>
    <div class="summary-buttons">
      <button onclick="filterByDays(30)" style="background-color: #ffe066;">Due in 30 Days</button>
      <button onclick="filterByDays(90)" style="background-color: #ffd43b;">Due in 90 Days</button>
      <button onclick="filterByDays(365)" style="background-color: #fab005;">Due in 365 Days</button>
      <button onclick="clearFilter()" style="background-color: #e0e0e0;">Clear</button>
    </div>
    <div class="search-bar">
      <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Search for site name, postcode, or store number...">
    </div>
    <table>
      <thead>
        <tr>
          <th>Store Number</th>
          <th>Site Name</th>
          <th>Postcode</th>
          <th>5YR Due</th>
          <th>PAT Due</th>
          <th>EM Due</th>
          <th>Forecourt Due</th>
          <th>EV Due</th>
          <th>PV Due</th>
          <th>Outcome</th>
          <th>Report</th>
        </tr>
      </thead>
      <tbody id="tableBody"></tbody>
    </table>
  </div>
  <script>
    let fullData = [];
    async function fetchData() {
      const res = await fetch('eicr-log.json');
      const data = await res.json();
      fullData = data;
      populateTable(data);
    }
    function populateTable(data) {
      const table = document.getElementById('tableBody');
      table.innerHTML = '';
      data.forEach(row => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${String(row.storeNumber).padStart(4, '0')}</td>
          <td>${row.siteName}</td>
          <td>${row.postcode}</td>
          <td>${row.fiveYrDueDate || ''}</td>
          <td>${row.patDueDate || ''}</td>
          <td>${row.emDueDate || ''}</td>
          <td>${row.forecourtDueDate || ''}</td>
          <td>${row.evDueDate || ''}</td>
          <td>${row.pvDueDate || ''}</td>
          <td>${row.outcome}</td>
          <td><a href="#">${row.reportURL}</a></td>
        `;
        table.appendChild(tr);
      });
    }
    function parseDate(d) {
      if (!d) return null;
      const parts = d.split("-");
      if (parts.length !== 3) return null;
      const months = {
        "Jan": 0, "Feb": 1, "Mar": 2, "Apr": 3, "May": 4, "Jun": 5,
        "Jul": 6, "Aug": 7, "Sep": 8, "Oct": 9, "Nov": 10, "Dec": 11
      };
      return new Date(parts[2], months[parts[1]], parts[0]);
    }
    function filterByDays(days) {
      const now = new Date();
      const cutoff = new Date();
      cutoff.setDate(now.getDate() + days);
      const filtered = fullData.filter(site => {
        const dueDates = ['fiveYrDueDate','patDueDate','emDueDate','forecourtDueDate','evDueDate','pvDueDate'];
        return dueDates.some(field => {
          const date = parseDate(site[field]);
          return date && date >= now && date <= cutoff;
        });
      }).sort((a, b) => {
        const dateA = parseDate(a.fiveYrDueDate || a.patDueDate || a.emDueDate);
        const dateB = parseDate(b.fiveYrDueDate || b.patDueDate || b.emDueDate);
        return dateA - dateB;
      });
      populateTable(filtered);
    }
    function clearFilter() {
      populateTable(fullData);
    }
    function searchTable() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.getElementById("tableBody").getElementsByTagName("tr");
      for (let i = 0; i < rows.length; i++) {
        const rowText = rows[i].textContent.toLowerCase();
        rows[i].style.display = rowText.includes(input) ? "" : "none";
      }
    }
    fetchData();
  </script>
</body>
</html>
