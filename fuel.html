
<!DOCTYPE html>
<html>
<head>
  <title>Fuel & Expenses</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: #e6e8eb url('Mostlane_Embossed.png') no-repeat center center fixed;
      background-size: 180%;
      padding: 40px 20px;
      color: #003366;
    }
    .form-container {
      background: rgba(255,255,255,0.6);
      padding: 20px;
      border-radius: 10px;
      max-width: 1000px;
      margin: auto;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .day-section {
      margin-top: 30px;
      padding: 15px;
      background: #f0f3f8;
      border-radius: 6px;
    }
    .postcode-entry {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    input[type="text"], input[type="date"], input[type="time"], button {
      width: 100%;
      padding: 10px;
      margin: 6px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .button {
      background: #004a99;
      color: white;
      cursor: pointer;
    }
  </style>
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCvcvG15HB6XBJBbnHifjL8jZtsSE5m0i4&callback=initMap"></script>
</head>
<body>
  <div class="form-container">
    <h1>Fuel & Expenses</h1>
    <label>Engineer Name</label>
    <input type="text" id="engineer" readonly>
    <label>Week Commencing</label>
    <input type="date" id="week">
    
    <div class="day-section">
      <h2>Monday</h2>
      <div id="monday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('monday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('monday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="monday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="monday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="monday-claim" readonly>
    </div>
    
    <div class="day-section">
      <h2>Tuesday</h2>
      <div id="tuesday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('tuesday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('tuesday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="tuesday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="tuesday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="tuesday-claim" readonly>
    </div>
    
    <div class="day-section">
      <h2>Wednesday</h2>
      <div id="wednesday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('wednesday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('wednesday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="wednesday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="wednesday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="wednesday-claim" readonly>
    </div>
    
    <div class="day-section">
      <h2>Thursday</h2>
      <div id="thursday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('thursday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('thursday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="thursday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="thursday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="thursday-claim" readonly>
    </div>
    
    <div class="day-section">
      <h2>Friday</h2>
      <div id="friday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('friday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('friday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="friday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="friday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="friday-claim" readonly>
    </div>
    
    <div class="day-section">
      <h2>Saturday</h2>
      <div id="saturday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('saturday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('saturday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="saturday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="saturday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="saturday-claim" readonly>
    </div>
    
    <div class="day-section">
      <h2>Sunday</h2>
      <div id="sunday-sites">
        <div class="postcode-entry">
          <input type="text" class="postcode" placeholder="Site Postcode">
        </div>
      </div>
      <button class="button" type="button" onclick="addPostcode('sunday')">+ Add Site</button>
      <button class="button" type="button" onclick="calculateRoute('sunday')">Calculate Mileage</button>
      <label>Total Mileage</label>
      <input type="text" id="sunday-total" readonly>
      <label>Chargeable Mileage</label>
      <input type="text" id="sunday-chargeable" readonly>
      <label>Fuel Claim (£0.25/mile)</label>
      <input type="text" id="sunday-claim" readonly>
    </div>
    
  </div>
<script>
  let directionsService;
  function initMap() {
    directionsService = new google.maps.DirectionsService();
    document.getElementById("engineer").value = sessionStorage.getItem("engineerName") || "";
  }

  function addPostcode(day) {
    const container = document.getElementById(day + "-sites");
    const div = document.createElement("div");
    div.className = "postcode-entry";
    div.innerHTML = '<input type="text" class="postcode" placeholder="Site Postcode">';
    container.appendChild(div);
  }

  function calculateRoute(day) {
    const inputs = document.querySelectorAll(`#$Sunday-sites .postcode`);
    const postcodes = Array.from(inputs).map(input => input.value.trim()).filter(Boolean);
    if (postcodes.length === 0) {
      alert("Please enter at least one site postcode for " + day);
      return;
    }

    const waypoints = postcodes.map(p => ({ location: p, stopover: true }));
    directionsService.route({
      origin: "PO15 5RQ",
      destination: "PO15 5RQ",
      waypoints: waypoints,
      optimizeWaypoints: false,
      travelMode: google.maps.TravelMode.DRIVING
    }, function(response, status) {
      if (status === google.maps.DirectionsStatus.OK) {
        let totalMeters = 0;
        for (let leg of response.routes[0].legs) {
          totalMeters += leg.distance.value;
        }
        const totalMiles = totalMeters / 1609.34;
        const chargeable = Math.max(totalMiles - 20, 0);
        const claim = chargeable * 0.25;

        document.getElementById(day + "-total").value = totalMiles.toFixed(2);
        document.getElementById(day + "-chargeable").value = chargeable.toFixed(2);
        document.getElementById(day + "-claim").value = "£" + claim.toFixed(2);
      } else {
        alert("Route calculation failed for " + day + ". Please check postcodes.");
      }
    });
  }
</script>
</body>
</html>
