<!DOCTYPE html>
<html>
<head>
  <title>Mostlane – Check In / Out</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h2>Mostlane – Check In / Out</h2>
  <button onclick="checkIn()">Check In</button>

  <script>
    function checkIn() {
      navigator.geolocation.getCurrentPosition(success, error);

      function success(position) {
        const latitude = position.coords.latitude;
        const longitude = position.coords.longitude;
        const deviceID = navigator.userAgent;
        const engineerName = localStorage.getItem("engineer") || "Unknown";

        const data = {
          status: "Arrived",
          lat: latitude,
          lon: longitude,
          device: deviceID,
          engineer: engineerName
        };

        fetch('https://script.google.com/macros/s/AKfycbwMCEPphtuw6p7CA_vdNtW3MbFhbei65gVRxFsHN7YoPxS5MHsfISqh34aeGt_LaDPn/exec', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded'
          },
          body: new URLSearchParams(data)
        })
        .then(response => response.text())
        .then(result => {
          console.log("Success:", result);
          window.location.href = `confirm.html?status=${data.status}&lat=${data.lat}&lon=${data.lon}&engineer=${data.engineer}`;
        })
        .catch(error => {
          console.error("Error!", error.message);
          alert("Error submitting data. Please try again.");
        });
      }

      function error() {
        alert("Location must be enabled to Check In.");
      }
    }
  </script>
</body>
</html>
