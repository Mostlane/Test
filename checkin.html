
<!DOCTYPE html>
<html>
<head>
  <title>Mostlane – Check In / Out</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
  <script>
    async function submitCheckInOut(action) {
      const engineer = localStorage.getItem("engineerName") || "Unknown";
      const device = navigator.userAgent;
      const time = new Date().toISOString();
      let lat = "";
      let lng = "";

      try {
        const pos = await new Promise((resolve, reject) =>
          navigator.geolocation.getCurrentPosition(resolve, reject, { timeout: 10000 })
        );
        lat = pos.coords.latitude;
        lng = pos.coords.longitude;
      } catch (err) {
        alert("Location must be enabled to Check In / Out.");
        return;
      }

      const payload = {
        action,
        engineer,
        device,
        time,
        lat,
        lng
      };

      try {
        const res = await fetch("https://script.google.com/macros/s/AKfycbwMCEPphtuw6p7CA_vdNtW3MbFhbei65gVRxFsHN7YoPxS5MHsfISqh34aeGt_LaDPn/exec", {
          method: "POST",
          body: JSON.stringify(payload),
          headers: { "Content-Type": "application/json" }
        });
        const data = await res.text();
        document.getElementById("status").innerText = data || "Check-in/out submitted.";
      } catch (err) {
        document.getElementById("status").innerText = "Error submitting data.";
      }
    }
  </script>
</head>
<body>
  <header><h1>Mostlane – Check In / Out</h1></header>

  <a class="button" onclick="submitCheckInOut('Check In')">Check In</a>
  <a class="button" onclick="submitCheckInOut('Check Out')">Check Out</a>
  <p id="status" style="text-align:center; margin-top: 30px;"></p>
  <a class="button" href="main.html">Back to Menu</a>
</body>
</html>
